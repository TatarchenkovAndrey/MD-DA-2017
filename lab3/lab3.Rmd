
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE)
```
#Лабораторная работа 3

### Задание 1

1. Используйте команду ``readLines`` для загрузки файла в текстовый вектор _html_.

    ```{r}
    html <- readLines("forbes.htm")
    ```
    Сколько строк в файле?
    ```{r}
    length(html)
    ```
    Сколько символов в файле?
    ```{r}
    sum(nchar(html))
    ```
   
2. Откройте файл в текстовом редакторе. Найдите строки, содержащие данные о Билле Гейтсе и Ларри Эллисоне и запомните размер их дохода.

          $72 B – Билл Гейтс
    
          $41 B – Ларри Эллисон

3. Напишите шаблон регулярного выражения и используйте функцию ``grep``, чтобы извлечь размер дохода из данных в векторе _html_.

    Удостоверьтесь, что полученный вектор номеров строк содержит содержит ровно 100 записей   и ссылается на номера строк в котрых действительно есть информация о доходе, а не просто    первый попавшийся текст.
    
    ```{r}
    pattern <- "\\${1}\\d+((,\\d{1} )| )B{1}"
    length(grep(pattern, html))
      
    html[grep(pattern,html)[1]]
    ```
    

4. Напишите код, использовав регулярное выражение из п. 3, и функции ``regexp`` и ``regmatches``, чтобы извлечь все данные о доходе.

    ```{r}
    res <- c(regmatches(html,regexpr(pattern, html)))
    ```
   
    Проверьте следующее:

    Должно быть ровно сто значений.
   
    ```{r}
    length(res)
    ```
   
    Самый большой доход должен быть доход Билла Гейтса
   
    ```{r}
    res[1]
    ```
   
    Такой доход должен быть в списке один раз.
   
    ```{r}
    !res[1] %in% res[duplicated(res)]
    ```
   
    В списке должна быть цифра, которую мы запомнили для Ларри Эллисона.
   
    ```{r}
    "$41 B" %in% res
    ```
    Должно быть как минимум два значения, встречающихся несколько раз.
   
    Количество повторяющихся значений:
   
    ```{r}
    sum(duplicated(res) == TRUE)
    ```
  
   
   
### Задание 2

5. В данных доход представлен в формате **"$42 B"**, что означает **42 × 10^9**.
    Преобразуйте этот формат в числовой и сохраните в вектор _worths_. 

    ```{r}
    worths <- as.numeric(gsub(",",".",regmatches(res, regexpr("\\d+((,\\d{1})|)", res)))) * 10^9
    worths
    ```
    Удостоверьтесь в следующем:

     _worths_ является вектором и в нём сто значений типа _double_.
   
    ```{r}
    is.vector(worths)
    length(worths)
    is.double(worths)
    ```
    
    Все элементы вектора _worths_ больше 1 миллиарда.
   
    ```{r}
    sum(worths > 1*10^9) == 100
    ```
    
      Самое большое число это доход Билла Гейтса.
      
    ```{r}
    max(worths) == 72*10^9
    ``` 
 
6. Используйте вектор _worths_ , чтобы выяснить следующее:
  
     Какова медиана ста этих записей?
   
    ```{r}
    median(worths)
    ```
   
     Средний доход?
   
    ```{r}
    mean(worths)
    ```
   
     Как много людей из этого списка имеют доход больше 5млрд., 10, 25? 
   
    ```{r}
    sum(worths > 5*10^9)
    
    sum(worths > 10*10^9)
    
    sum(worths > 25*10^9)
    ```
   
     Какой их общий доход?
   
    ```{r}
    all.sum <- sum(worths)
    all.sum
    ```
   
     Какую долю от общего дохода, составляет пятёрка самых богатых.
   
    ```{r}
    sum(worths[1:5])/all.sum
    ```
   
     Какую долю от общего дохода, составляют 20 самых богатых.
     
    ```{r}
    sum(worths[1:20])/all.sum
    ```
   
7. В данных [федерального резерва США](https://www.federalreserve.gov/releases/z1/current/z1.pdf) найдите показатель дохода всех домохозяйств (Household net worth) в соответвующем году, какую долю
   общего дохода составляют 100 богатейших людей. 
     
    ```{r}
    hnw <- 78.536*10^9
    sum(worths)/hnw
    ```
    Результат: 16.46379
    
    Должно быть, ошибка в тексте задания, а решение будет выглядеть так:
    
    
    ```{r}
    hnw <- 78.536*10^9
    hnw / sum(worths)
    ```